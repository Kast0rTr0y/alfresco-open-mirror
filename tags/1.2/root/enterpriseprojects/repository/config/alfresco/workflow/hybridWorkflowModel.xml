<model name="hwf:hybridWorkflowModel" xmlns="http://www.alfresco.org/model/dictionary/1.0">

    <description>Hybrid workflow model</description>
    <author>Alfresco</author>
    <version>1.0</version>

    <!-- Imports are required to allow references to definitions in other models -->
    <imports>
        <!-- Import Alfresco Dictionary Definitions -->
        <import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d" />
        <import uri="http://www.alfresco.org/model/bpm/1.0" prefix="bpm" />
        <import uri="http://www.alfresco.org/model/content/1.0" prefix="cm" />
    </imports>

    <namespaces>
        <namespace uri="http://www.alfresco.org/model/hybridworkflow/1.0" prefix="hwf" />
    </namespaces>

     <constraints>
        <constraint name="hwf:allowedRetainStratagy" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>documentsSynced</value>
                    <value>documentsUnSynced</value>
                    <value>documentsDelete</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="hwf:allowedCloudWorkflowType" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>task</value>
                    <value>review</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="hwf:allowedWorkflowStatus" type="LIST">
            <parameter name="allowedValues">
                <list>
                   <value>startedOnPremise</value>
                   <value>startedOnCloud</value>
                   <value>finishedOnCloud</value>
                   <value>finishedOnPremise</value>
                   <value>cancelledOnPremise</value>
                   <value>cancelledOnCloud</value>
                </list>
            </parameter>
        </constraint>
    </constraints>
    
    <types>
       <type name="hwf:submitCloudWorkflow">
         <parent>bpm:startTask</parent>
         <properties>
            <property name="hwf:cloudDestination">
                <title>Destination</title>
                <type>d:text</type>
                <mandatory>true</mandatory>
            </property>
            <property name="hwf:lockOnPremiseCopy">
               <title>Lock on-premise content</title>
               <type>d:boolean</type> 
            </property>
          </properties>
          <mandatory-aspects>
            <aspect>hwf:hybridWorklfowInfo</aspect>
          </mandatory-aspects>
      </type>
      
      <type name="hwf:approvedCloudTask">
         <parent>bpm:workflowTask</parent>
          <overrides>
            <property name="bpm:reassignable">
               <default>false</default>
            </property>
          </overrides>
          <mandatory-aspects>
            <aspect>hwf:approvalInfo</aspect>
          </mandatory-aspects>
      </type>
      <type name="hwf:rejectedCloudTask">
         <parent>bpm:workflowTask</parent>
         <overrides>
            <property name="bpm:reassignable">
               <default>false</default>
            </property>
          </overrides>
          <mandatory-aspects>
            <aspect>hwf:approvalInfo</aspect>
          </mandatory-aspects>
      </type>
      <type name="hwf:finishedCloudTask">
         <parent>bpm:workflowTask</parent>
         <overrides>
            <property name="bpm:reassignable">
               <default>false</default>
            </property>
          </overrides>
          <mandatory-aspects>
            <aspect>hwf:hasComment</aspect>
          </mandatory-aspects>
      </type>
      <type name="hwf:cancelledCloudTask">
         <parent>bpm:workflowTask</parent>
          <overrides>
            <property name="bpm:reassignable">
               <default>false</default>
            </property>
          </overrides>
          <mandatory-aspects>
            <aspect>hwf:hasComment</aspect>
          </mandatory-aspects>
      </type>
   </types>
   
   <aspects>
      <aspect name="hwf:hasComment">
          <title>Hybrid workflow comment aspect</title>
          <properties>
             <property name="hwf:comments">
                  <title>Comments</title>
                  <type>d:text</type>
                  <multiple>true</multiple>
             </property>
          </properties>
      </aspect>
      
      <aspect name="hwf:approvalInfo">
          <title>Hybrid workflow comment aspect</title>
         <parent>hwf:hasComment</parent>
          <properties>
             <property name="hwf:requiredApprovalPercentage">
                <title>Required approval percentage</title>
                <type>d:int</type>
                <mandatory>true</mandatory>
                <default>50</default>
                <constraints>
                    <constraint type="MINMAX">
                        <parameter name="minValue"><value>1</value></parameter>
                        <parameter name="maxValue"><value>100</value></parameter>
                    </constraint>
                </constraints>
            </property>
            <property name="hwf:actualApprovalPercentage">
                <title>Actual approval percentage</title>
                <type>d:int</type>
                <mandatory>false</mandatory>
            </property>
          </properties>
      </aspect>
      
      <!-- Base aspect containing properties describing a cloud-workflow -->
      <aspect name="hwf:hybridWorklfowInfo">
         <title>Hybrid Workflow Info Aspect</title>
         <parent>hwf:approvalInfo</parent>
         <properties>
            <property name="hwf:cloudWorkflowType">
               <title>Type</title>
               <type>d:text</type>
               <default>task</default>
               <constraints>
                  <constraint ref="hwf:allowedCloudWorkflowType" />
              </constraints>
            </property>
            <property name="hwf:retainStrategy">
               <title>Retain cloud-content after completion</title>
               <type>d:text</type> 
               <mandatory>true</mandatory>
               <default>documentsUnSynced</default>
               <constraints>
                  <constraint ref="hwf:allowedRetainStratagy" />
              </constraints>
            </property>
            <property name="hwf:assignment">
               <title>Status</title>
               <type>d:text</type> 
               <mandatory>true</mandatory>
            </property>
         </properties>   
      </aspect>
      
      <aspect name="hwf:hybridWorkflow">
         <title>Hybrid workflow Aspect</title>
         <parent>hwf:hybridWorklfowInfo</parent>
         <properties>
            <property name="hwf:onPremiseWorkflowId">
               <title>On-premise Workflow-id</title>
               <type>d:text</type> 
            </property>
            <property name="hwf:workflowStatus">
               <title>Status</title>
               <type>d:text</type> 
               <mandatory>true</mandatory>
               <default>startedOnPremise</default>
               <constraints>
                  <constraint ref="hwf:allowedWorkflowStatus" />
               </constraints>
            </property>
            <property name="hwf:workflowDescription">
               <title>Description</title>
               <type>d:text</type> 
            </property>
            <property name="hwf:workflowDueDate">
               <title>Due date</title>
               <type>d:date</type> 
            </property>
            <property name="hwf:workflowPriority">
               <title>Due date</title>
               <type>d:int</type>
                <mandatory>true</mandatory>
                <default>2</default>
                <constraints>
                   <constraint ref="bpm:allowedPriority" />
                </constraints>
            </property>
            <property name="hwf:result">
               <title>Result</title>
               <type>d:text</type> 
            </property>
            
         </properties>
      </aspect>
   </aspects>
</model>