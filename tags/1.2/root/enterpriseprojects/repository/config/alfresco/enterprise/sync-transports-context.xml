<?xml version='1.0' encoding='UTF-8'?>

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
                           http://www.springframework.org/schema/tx      http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">

   <!-- Cloud Sync Member Node Transport Service -->
   <bean id="CloudSyncMemberNodeTransport" class="org.springframework.aop.framework.ProxyFactoryBean">
      <property name="proxyInterfaces">
         <value>org.alfresco.enterprise.repo.sync.transport.CloudSyncMemberNodeTransport</value>
      </property>
      <property name="target">
         <ref bean="cloudSyncMemberNodeTransport" />
      </property>
      <property name="interceptorNames">
         <list>
            <!-- No transaction wrappers needed, most things are stateless, and a few bits -->
            <!--  need to do explicit transaction management -->
            <idref bean="AuditMethodInterceptor" />
            <idref bean="exceptionTranslator" />
            <idref bean="cloudSyncMemberNodeTransport_security" />
         </list>
      </property>
   </bean>

   <!-- Cloud Sync Set Definition (SSD) Transport Service -->
   <bean id="CloudSyncSetDefinitionTransport" class="org.springframework.aop.framework.ProxyFactoryBean">
      <property name="proxyInterfaces">
         <value>org.alfresco.enterprise.repo.sync.transport.CloudSyncSetDefinitionTransport</value>
      </property>
      <property name="target">
         <ref bean="cloudSyncSetDefinitionTransport" />
      </property>
      <property name="interceptorNames">
         <list>
            <!-- No transaction wrappers needed, most things are stateless, and a few bits -->
            <!--  need to do explicit transaction management -->
            <idref bean="AuditMethodInterceptor" />
            <idref bean="exceptionTranslator" />
            <idref bean="cloudSyncSetDefinitionTransport_security" />
         </list>
      </property>
   </bean>


   <!-- Cloud Sync Member Node Transport Service Security -->
   <!-- Currently, everything is allowed, and checks are done (where needed) by -->
   <!--  the public services we depend on -->
   <bean id="cloudSyncMemberNodeTransport_security" class="org.alfresco.repo.security.permissions.impl.AlwaysProceedMethodInterceptor" />

   <!-- Cloud Sync Set Definition Transport Service Security -->
   <!-- Currently, everything is allowed, and checks are done (where needed) by -->
   <!--  the public services we depend on -->
   <bean id="cloudSyncSetDefinitionTransport_security" class="org.alfresco.repo.security.permissions.impl.AlwaysProceedMethodInterceptor" />


   <!-- Cloud Sync Member Node Transport Service base bean -->
	<bean id="cloudSyncMemberNodeTransport" class="org.alfresco.enterprise.repo.sync.transport.impl.CloudSyncMemberNodeTransportImpl">
        <property name="retryingTransactionHelper" ref="retryingTransactionHelper"/>
        <property name="cloudConnectorService" ref="CloudConnectorService"/>
        <property name="namespaceService" ref="NamespaceService"/>
        <property name="contentService" ref="ContentService"/>
        <property name="syncService" ref="SyncService"/>
        <property name="nodeService" ref="NodeService"/>
        <property name="eventPublisher" ref="eventPublisher" />
	</bean>

   <!-- Cloud Sync Set Definition Transport Service base bean -->
	<bean id="cloudSyncSetDefinitionTransport" class="org.alfresco.enterprise.repo.sync.transport.impl.CloudSyncSetDefinitionTransportImpl">
        <property name="cloudConnectorService" ref="CloudConnectorService"/>
	</bean>


   <!-- TODO Move this cloud specific bit to be THOR only -->
   <!-- It's here for now for testing -->
   <alias alias="CloudSyncOnCloudService" name="cloudSyncOnCloudService" />
   <bean id="cloudSyncOnCloudService" class="org.alfresco.enterprise.repo.sync.transport.impl.AlwaysProceedCloudSyncOnCloudService" />
</beans>
