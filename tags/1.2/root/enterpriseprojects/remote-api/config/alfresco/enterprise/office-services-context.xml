<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="officeServicesProperties" parent="common-placeholder-configurer">
        <property name="locations">
            <list>
                <value>classpath*:alfresco/enterprise/office-services.properties</value>
                <!-- Override -->
                <value>classpath*:alfresco/extension/custom-office-services.properties</value>
            </list>
        </property>
        <property name="properties">
            <props>
                <prop key="aos.baseUrlOverwrite"></prop>
                <prop key="aos.sitePathOverwrite"></prop>
            </props>
        </property>
    </bean>
   
    <bean id="officeServicesDictionaryBootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap">
        <property name="models">
            <list>
                <value>alfresco/model/officeServicesModel.xml</value>
            </list>
        </property>
    </bean>
   
    <bean id="officeServicesResourceBundle" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
        <property name="resourceBundles">
            <list>
                <value>alfresco.enterprise.messages.office-services</value>
            </list>
        </property>
    </bean>
    
    <bean id="aosActivityPoster" class="org.alfresco.repo.webdav.ActivityPosterImpl">
        <property name="appTool" value="Sharepoint"/>
        <property name="poster" ref="activitiesPoster" />
    </bean>

    <bean id="AosVirtualFileSystem" class="org.alfresco.enterprise.repo.officeservices.vfs.AlfrescoVirtualFileSystem">
        <property name="authenticationService">
            <ref bean="authenticationService" />
        </property>
        <property name="nodeService">
            <ref bean="NodeService" />
        </property>
        <property name="fileFolderService">
            <ref bean="FileFolderService" />
        </property>
        <property name="checkOutCheckInService">
            <ref bean="CheckOutCheckInService" />
        </property>
        <property name="lockService">
            <ref bean="LockService" />
        </property>
        <property name="versionService">
         <ref bean="VersionService" />
        </property>
        <property name="dictionaryService">
            <ref bean="DictionaryService" />
        </property>
        <property name="namespaceService">
            <ref bean="NamespaceService" />
        </property>
        <property name="mimetypeService">
            <ref bean="MimetypeService" />
        </property>
        <property name="searchService">
            <ref bean="SearchService" />
        </property>
        <property name="policyBehaviourFilter">
            <ref bean="policyBehaviourFilter" />
        </property>
        <property name="transactionService">
            <ref bean="TransactionService" />
        </property>
        <property name="tenantService">
            <ref bean="tenantService" />
        </property>
        <property name="siteService">
            <ref bean="SiteService" />
        </property>
        <property name="webDavHelper">
            <ref bean="webDAVHelper" />
        </property>
        <property name="webDavInitParams">
            <ref bean="webdav.initParams" />
        </property>
        <property name="authenticationContext">
            <ref bean="authenticationContext" />
        </property>
        <property name="activityPoster">
            <ref bean="aosActivityPoster" />
        </property>
        <property name="dataModelMappingConfiguration">
            <ref bean="aosDataModelMappingConfiguration" />
        </property>
        <property name="ioContentFilterRegistry">
            <ref bean="aosIOContentFilterRegistry" />
        </property>
        <property name="singletonCache">
            <ref bean="immutableSingletonCache" />
        </property>
        <property name="baseUrlOverwrite">
            <value>${aos.baseUrlOverwrite}</value>
        </property>
        <property name="sitePathOverwrite">
            <value>${aos.sitePathOverwrite}</value>
        </property>
        <property name="tempDirectoryName">
            <value>${aos.tempDirectoryName}</value>
        </property>
        <property name="encryptTempFiles">
            <value>${aos.encryptTempFiles}</value>
        </property>
        <property name="tempFileThreshold">
            <value>${aos.tempFileThreshold}</value>
        </property>
        <property name="tempFileMaxContentSize">
            <value>${aos.tempFileMaxContentSize}</value>
        </property>
    </bean>

    <bean id="AosAuthenticationFilter" class="org.alfresco.repo.management.subsystems.ChainingSubsystemProxyFactory">
        <property name="applicationContextManager">
            <ref bean="Authentication" />
        </property>
        <property name="interfaces">
            <list>
                <value>org.alfresco.repo.web.filter.beans.DependencyInjectedFilter</value>
            </list>
        </property>
        <property name="sourceBeanName">
            <value>webDavAuthenticationFilter</value>
        </property>
        <!-- Fall back to the default alfresco implementation -->
        <property name="defaultTarget">
            <bean class="org.alfresco.enterprise.repo.officeservices.auth.AuthenticationFilter">
                <property name="authenticationService">
                    <ref bean="AuthenticationService" />
                </property>
                <property name="personService">
                    <ref bean="PersonService" />
                </property>
                <property name="nodeService">
                    <ref bean="NodeService" />
                </property>
                <property name="transactionService">
                    <ref bean="TransactionService" />
                </property>
                <property name="authenticationComponent">
                    <ref bean="AuthenticationComponent" />
                </property>
                <property name="remoteUserMapper">
                    <ref bean="RemoteUserMapper" />
                </property>
            </bean>
        </property>
    </bean>
   
    <bean id="AosFileDialogWebViewRegistry" class="org.alfresco.enterprise.repo.officeservices.service.FileDialogWebViewRegistry" />

    <bean id="aosBaseFileDialogWebViewConfiguration" class="org.alfresco.enterprise.repo.officeservices.service.StandardFileDialogWebViewConfiguration" abstract="true" init-method="register">
        <property name="registry">
            <ref bean="AosFileDialogWebViewRegistry" />
        </property>
    </bean>
   
    <bean id="aosStandardFileDialogWebViewConfiguration" parent="aosBaseFileDialogWebViewConfiguration">
        <property name="pathPattern">
            <value>/.*</value>
        </property>
        <property name="templateLocation">
            <value>alfresco/enterprise/aos/FileDialog.ftl</value>
        </property>
    </bean>
   
    <bean id="aosIOContentFilterRegistry" class="org.alfresco.enterprise.repo.officeservices.metadata.StandardIOContentFilterRegistry" />
   
    <bean id="aosBaseContentFilter" class="org.alfresco.enterprise.repo.officeservices.metadata.AbstractContentFilter" abstract="true" init-method="register">
        <property name="registry">
            <ref bean="aosIOContentFilterRegistry" />
        </property>
        <property name="nodeService">
            <ref bean="NodeService" />
        </property>
    </bean>
    
    <bean id="aosBaseDataModelMappingConfiguration" class="org.alfresco.enterprise.repo.officeservices.metadata.DataModelMappingConfiguration" abstract="true">
        <property name="dictionaryService">
            <ref bean="DictionaryService" />
        </property>
        <property name="documentRootType">
            <value>{http://www.alfresco.org/model/content/1.0}content</value>
        </property>
        <property name="folderRootType">
            <value>{http://www.alfresco.org/model/content/1.0}folder</value>
        </property>
        <property name="includedTypesPatterns">
            <list>
            </list>
        </property>
        <property name="excludedTypesPatterns">
            <list>
                <value>\Q{http://www.alfresco.org/model/content/1.0}dictionaryModel\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}savedquery\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}thumbnail\E</value>
            </list>
        </property>
        <property name="includedAspectsPatterns">
            <list>
                <value>\Q{http://www.alfresco.org/model/content/1.0}titled\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}auditable\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}complianceable\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}ownable\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}effectivity\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}summarizable\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}geographic\E</value>
            </list>
        </property>
        <property name="excludedAspectsPatterns">
            <list>
                <value>\Q{http://www.alfresco.org/model/system/1.0}\E.*</value>
                <value>\Q{http://www.alfresco.org/model/rendition/1.0}\E.*</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}lockable\E</value>
                <value>\Q{http://www.alfresco.org/model/content/1.0}versionable\E</value>
            </list>
        </property>
        <property name="includedPropertiesPatterns">
            <list>
                <value>.*</value>
            </list>
        </property>
        <property name="excludedPropertiesPatterns">
            <list>
                <value>\Q{http://www.alfresco.org/model/content/1.0}name\E</value>
            </list>
        </property>
        <property name="includedInstantiableTypesPatterns">
            <list>
            </list>
        </property>
        <property name="excludedInstantiableTypesPatterns">
            <list>
            </list>
        </property>
    </bean>
    
    <bean id="aosDataModelMappingConfiguration" class="org.alfresco.enterprise.repo.officeservices.metadata.StandardDataModelMappingConfiguration" parent="aosBaseDataModelMappingConfiguration">
    </bean>
   
    <bean id="aosServerPropertiesProvider" class="org.alfresco.enterprise.repo.officeservices.metadata.StandardServerPropertiesProvider">
        <property name="nodeService">
            <ref bean="NodeService" />
        </property>
        <property name="dictionaryService">
            <ref bean="DictionaryService" />
        </property>
        <property name="namespaceService">
            <ref bean="NamespaceService" />
        </property>
        <property name="dataModelMappingConfiguration">
            <ref bean="aosDataModelMappingConfiguration" />
        </property>
        <property name="titleProperty">
            <value>{http://www.alfresco.org/model/content/1.0}title</value>
        </property>
    </bean>

    <bean id="aosOLEFileContentOutputFilter" class="org.alfresco.enterprise.repo.officeservices.metadata.OLEFileContentFilter" parent="aosBaseContentFilter">
        <property name="outputFilter">
            <value>true</value>
        </property>
        <property name="restrictedToMimetypes">
            <list>
                <value>application/msword</value>
                <value>application/vnd.ms-word</value>
                <value>application/msexcel</value>
                <value>application/vnd.ms-excel</value>
                <value>application/mspowerpoint</value>
                <value>application/vnd.ms-powerpoint</value>
                <value></value>
            </list>
        </property>
        <property name="processors">
            <list>
                <bean class="org.alfresco.enterprise.repo.officeservices.metadata.OLEServerPropertiesInjector">
                    <property name="nodeService">
                        <ref bean="NodeService" />
                    </property>
                    <property name="dictionaryService">
                        <ref bean="DictionaryService" />
                    </property>
                    <property name="dataModelMappingConfiguration">
                        <ref bean="aosDataModelMappingConfiguration" />
                    </property>
                    <property name="serverPropertiesProvider">
                        <ref bean="aosServerPropertiesProvider" />
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="aosOOXMLFileContentOutputFilter" class="org.alfresco.enterprise.repo.officeservices.metadata.OOXMLFileContentFilter" parent="aosBaseContentFilter">
        <property name="outputFilter">
            <value>true</value>
        </property>
        <property name="restrictedToMimetypes">
            <list>
                <value>application/vnd.openxmlformats-officedocument.wordprocessingml.document</value>
                <value>application/vnd.ms-word.document.macroenabled.12</value>
                <value>application/vnd.openxmlformats-officedocument.wordprocessingml.template</value>
                <value>application/vnd.ms-word.template.macroenabled.12</value>
                <value>application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</value>
                <value>application/vnd.openxmlformats-officedocument.spreadsheetml.template</value>
                <value>application/vnd.ms-excel.sheet.macroenabled.12</value>
                <value>application/vnd.ms-excel.template.macroenabled.12</value>
                <value>application/vnd.ms-excel.addin.macroenabled.12</value>
                <value>application/vnd.ms-excel.sheet.binary.macroenabled.12</value>
                <value>application/vnd.openxmlformats-officedocument.presentationml.presentation</value>
                <value>application/vnd.ms-powerpoint.presentation.macroenabled.12</value>
                <value>application/vnd.openxmlformats-officedocument.presentationml.slideshow</value>
                <value>application/vnd.ms-powerpoint.slideshow.macroenabled.12</value>
                <value>application/vnd.openxmlformats-officedocument.presentationml.template</value>
                <value>application/vnd.ms-powerpoint.template.macroenabled.12</value>
                <value>application/vnd.ms-powerpoint.addin.macroenabled.12</value>
                <value>application/vnd.openxmlformats-officedocument.presentationml.slide</value>
                <value>application/vnd.ms-powerpoint.slide.macroEnabled.12</value>
            </list>
        </property>
        <property name="processors">
            <list>
                <bean class="org.alfresco.enterprise.repo.officeservices.metadata.OOXMLServerPropertiesInjector">
                    <property name="nodeService">
                        <ref bean="NodeService" />
                    </property>
                    <property name="dictionaryService">
                        <ref bean="DictionaryService" />
                    </property>
                    <property name="dataModelMappingConfiguration">
                        <ref bean="aosDataModelMappingConfiguration" />
                    </property>
                    <property name="serverPropertiesProvider">
                        <ref bean="aosServerPropertiesProvider" />
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="aosOOXMLFileContentInputFilter" class="org.alfresco.enterprise.repo.officeservices.metadata.OOXMLFileContentFilter" parent="aosBaseContentFilter">
        <property name="inputFilter">
            <value>true</value>
        </property>
        <property name="processors">
            <list>
                <bean class="org.alfresco.enterprise.repo.officeservices.metadata.OOXMLServerPropertiesExtractor">
                    <property name="nodeService">
                        <ref bean="NodeService" />
                    </property>
                    <property name="dictionaryService">
                        <ref bean="DictionaryService" />
                    </property>
                    <property name="dataModelMappingConfiguration">
                        <ref bean="aosDataModelMappingConfiguration" />
                    </property>
                    <property name="serverPropertiesProvider">
                        <ref bean="aosServerPropertiesProvider" />
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="aosOLEFileContentInputFilter" class="org.alfresco.enterprise.repo.officeservices.metadata.OLEFileContentFilter" parent="aosBaseContentFilter">
        <property name="inputFilter">
            <value>true</value>
        </property>
        <property name="processors">
            <list>
                <bean class="org.alfresco.enterprise.repo.officeservices.metadata.OLEServerPropertiesExtractor">
                    <property name="nodeService">
                        <ref bean="NodeService" />
                    </property>
                    <property name="dictionaryService">
                        <ref bean="DictionaryService" />
                    </property>
                    <property name="dataModelMappingConfiguration">
                        <ref bean="aosDataModelMappingConfiguration" />
                    </property>
                    <property name="serverPropertiesProvider">
                        <ref bean="aosServerPropertiesProvider" />
                    </property>
                </bean>
            </list>
        </property>
    </bean>
   
</beans>
