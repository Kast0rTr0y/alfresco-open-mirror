<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

    <!-- The Account Service -->
    <bean id="AccountService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_cloud.accounts.AccountService</value>
        </property>
        <property name="target">
            <ref bean="accountService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="AccountService_transaction"/>
                <idref bean="AuditMethodInterceptor" />
                <idref bean="exceptionTranslator" />
                <idref local="AccountService_security"/>
            </list>
        </property>
    </bean>
    
    <!-- Account Service transaction bean -->
    <bean id="AccountService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>
    
    <!-- Account Service security bean -->
    <bean id="AccountService_security" class="org.alfresco.repo.security.permissions.impl.AlwaysProceedMethodInterceptor" />
    
    <!-- This abstract base bean is an extension point for test implementations of this service -->
    <bean id="baseAccountService" abstract="true">
       <property name="accountRegistry" ref="accountRegistry"/>
    </bean>
    
    <bean id="accountService" class="org.alfresco.module.org_alfresco_module_cloud.accounts.AccountServiceImpl" parent="baseAccountService">
        <property name="accountDAO" ref="accountDAO"/>
        <property name="accountsCannedQueryFactory" ref="accountsCannedQueryFactory"/> 
        <property name="tenantAdminService" ref="tenantAdminService"/>
    </bean>
    
    <bean id="accountResourceBundles" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
        <property name="resourceBundles">
            <list>
                <value>alfresco.messages.account-service</value>
            </list>
        </property>
    </bean>
    
    
    
    
    <!-- Import the various account types that we have defined. -->
    <import resource="classpath:alfresco/module/org_alfresco_module_cloud/account-types-context.xml"/>
    
    
    <!--                 -->
    <!-- Account Classes -->
    <!--                 -->
    
    <!-- A self-registering parent bean for all account classes -->
    <bean id="baseAccountClass" abstract="true" init-method="init">
        <property name="accountRegistry" ref="accountRegistry"/>
    </bean>
    
    <!-- Free. Public email domain. e.g. gmail.com -->
    <bean id="publicEmailDomainClass" parent="baseAccountClass" class="org.alfresco.module.org_alfresco_module_cloud.accounts.AccountClass">
        <property name="name" value="PUBLIC_EMAIL_DOMAIN"/>
        <property name="minCode" value="-1"/>
        <property name="maxCode" value="-1"/>
        <property name="paidNetwork" value="false"/>
    </bean>
    
    <!-- Free. Private email domain. e.g. alfresco.com -->
    <bean id="privateEmailDomainClass" parent="baseAccountClass" class="org.alfresco.module.org_alfresco_module_cloud.accounts.AccountClass">
        <property name="name" value="PRIVATE_EMAIL_DOMAIN"/>
        <property name="minCode" value="0"/>
        <property name="maxCode" value="0"/>
        <property name="paidNetwork" value="false"/>
    </bean>
    
    <!-- Paid business account. -->
    <bean id="businessClass" parent="baseAccountClass" class="org.alfresco.module.org_alfresco_module_cloud.accounts.AccountClass">
        <property name="name" value="PAID_BUSINESS"/>
        <property name="minCode" value="100"/>
        <property name="paidNetwork" value="true"/>
        <!-- no maxCode, unbounded range. -->
    </bean>
    
    <!-- The Account registry itself. -->
    <bean id="accountRegistry" class="org.alfresco.module.org_alfresco_module_cloud.accounts.AccountRegistry"/>
    
    
    <!--                     -->
    <!-- Account Persistence -->
    <!--                     -->
    
    <!-- Account DAO Class -->
    <bean id="accountDAO" class="org.alfresco.module.org_alfresco_module_cloud.accounts.domain.AccountDAOImpl">
        <property name="sqlSessionTemplate" ref="cloudSqlSessionTemplate"/>
        <property name="accountEntityCache" ref="accountEntityCache"/>
    </bean>
    
    <bean name="accountsCannedQueryFactory" class="org.alfresco.module.org_alfresco_module_cloud.accounts.AccountsCannedQueryFactory">
        <property name="registry" ref="cannedQueryRegistry"/>
        <property name="cannedQueryDAO" ref="cloudCannedQueryDAO"/>
    </bean>
    
</beans>
