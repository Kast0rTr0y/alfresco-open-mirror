<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

    <!-- The Cloud Invitation Service -->
    <bean id="CloudInvitationService" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="proxyInterfaces">
            <value>org.alfresco.module.org_alfresco_module_cloud.invitation.CloudInvitationService</value>
        </property>
        <property name="target">
            <ref bean="cloudInvitationService"/>
        </property>
        <property name="interceptorNames">
            <list>
                <idref local="CloudInvitationService_transaction"/>
                <idref bean="AuditMethodInterceptor" />
                <idref bean="exceptionTranslator" />
                <idref local="CloudInvitationService_security"/>
            </list>
        </property>
    </bean>
    
    <bean id="CloudInvitationService_transaction" class="org.springframework.transaction.interceptor.TransactionInterceptor">
        <property name="transactionManager">
            <ref bean="transactionManager"/>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">${server.transaction.mode.default}</prop>
            </props>
        </property>
    </bean>
    
    <bean id="CloudInvitationService_security" class="org.alfresco.repo.security.permissions.impl.AlwaysProceedMethodInterceptor" />
    
    <bean id="cloudInvitationService" class="org.alfresco.module.org_alfresco_module_cloud.invitation.CloudInvitationServiceImpl">
        <property name="accountService" ref="AccountService"/>
        <property name="directoryService" ref="directoryService"/>
        <property name="emailAddressService" ref="emailAddressService"/>
        <property name="namespaceService" ref="NamespaceService"/>
        <property name="nodeService" ref="NodeService"/>
        <property name="personService" ref="PersonService"/>
        <property name="registrationService" ref="RegistrationService"/>
        <property name="siteService" ref="SiteService"/>
        <property name="workflowService" ref="WorkflowService"/>
        <property name="samlConfigAdminService" ref="samlConfigAdminService"/>
        <property name="timerRemind3" value="${cloud.invite.remindTimer3}" />
        <property name="timerRemind7" value="${cloud.invite.remindTimer7}" />
        <property name="timerEnd" value="${cloud.invite.endTimer}" />
    </bean>
    
    <bean id="cloudInvitationResourceBundles" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
        <property name="resourceBundles">
            <list>
                <value>alfresco.messages.cloud-invitation-service</value>
            </list>
        </property>
   </bean>
    
    
    <!-- Activiti Delegate beans for invitation workflow -->
    <bean id="baseCloudInvitationDelegate" parent="baseJavaDelegate" abstract="true">
        <property name="cloudInvitationService" ref="CloudInvitationService"/>
        <property name="sysAdminParams" ref="sysAdminParams"/>
    </bean>
    
    <bean id="SendCloudInvitationEmailDelegate" parent="baseCloudInvitationDelegate"
         class="org.alfresco.module.org_alfresco_module_cloud.invitation.SendCloudInvitationEmailDelegate">
         <property name="emailHelper" ref="cloudEmailHelper"/>
         <property name="emailSender" value="noreply@alfresco.com"/> <!-- TODO Externalise -->
         <property name="preferenceService" ref="preferenceService"/>
         <property name="emailAddressService" ref="emailAddressService"/>
         <property name="samlConfigAdminService" ref="samlConfigAdminService"/>
    </bean>
    
    <bean id="SiteIngressDelegate" parent="baseCloudInvitationDelegate"
         class="org.alfresco.module.org_alfresco_module_cloud.invitation.SiteIngressDelegate"/>
</beans>
