<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>

<beans>

    <!--                   -->
    <!--  Schema Extension -->
    <!--                   -->

    <!-- Ensure that the schema is bootstrapped -->
    <bean id="schema.create.cloud" class="org.alfresco.repo.domain.schema.SchemaBootstrapRegistration" init-method="register">
        <property name="schemaBootstrap" ref="schemaBootstrap" />
        <property name="preCreateScriptUrls">
            <list>
                <value>classpath:alfresco/module/org_alfresco_module_cloud/dbscripts/create/${db.script.dialect}/AlfrescoCreate-AccountTables.sql</value>
                <value>classpath:alfresco/module/org_alfresco_module_cloud/dbscripts/create/${db.script.dialect}/AlfrescoCreate-BlacklistTables.sql</value>
            </list>
        </property>
    </bean>
    
    <!--                   -->
    <!-- Patch overrides   -->
    <!--                   -->

    <bean id="patch.db-V4.1-NodeDeleted" class="org.alfresco.repo.admin.patch.impl.SchemaUpgradeScriptPatch" parent="basePatch">
        <property name="id"><value>patch.db-V4.1-NodeDeleted</value></property>
        <property name="description"><value>patch.schemaUpgradeScript.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>6014</value></property>
        <property name="targetSchema"><value>6015</value></property>
        <property name="scriptUrl">
            <value>classpath:alfresco/module/org_alfresco_module_cloud/dbscripts/upgrade/NodeDeleted.sql</value>
        </property>
    </bean>
    
    <!--                   -->
    <!--  Disabled Patches -->
    <!--                   -->

    <!-- Not relevant to cloud as email templates are stored in classpath -->
    <bean id="patch.addDutchEmailTemplatesPatch" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch">
        <property name="id"><value>patch.addDutchEmailTemplatesPatch</value></property>
        <property name="description"><value>>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>5023</value></property>
        <property name="targetSchema"><value>5024</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>

    <!-- Not relevant to cloud as there aren't any bpm packages which have been created with v3 of Alfresco -->
    <bean id="patch.fixBpmPackages" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch">
        <property name="id"><value>patch.fixBpmPackages</value></property>
        <property name="description"><value>>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>5024</value></property>
        <property name="targetSchema"><value>5025</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>

    <!-- Unsubscribed Aspect not applied in cloud -->
    <bean id="patch.imapUnsubscribedAspect" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch">
        <property name="id"><value>patch.imapUnsubscribedAspect</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>5026</value></property>
        <property name="targetSchema"><value>5027</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- No Sample Web Site in cloud -->
    <bean id="patch.swsdpPatch" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.swsdpPatch</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>5033</value></property>
        <property name="targetSchema"><value>5034</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    <!-- No Sample Web Site in Cloud: CLOUD-1480 -->
    <bean id="patch.siteLoadPatch.swsdp" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.swsdpPatch</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>6022</value></property>
        <property name="targetSchema"><value>6023</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- IMAP is disabled in Cloud: CLOUD-1743 -->
    <bean id="patch.imapFolders" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.imapFolders</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>6022</value></property>
        <property name="targetSchema"><value>6023</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- ALF-15231 This patch is disabled on Cloud -->
    <!-- Each tenant does lazy-creation of the credentials container, in the service when needed --> 
    <bean id="patch.remoteCredentialsContainer" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.remoteCredentialsContainer</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>5031</value></property>
        <property name="targetSchema"><value>5032</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- ALF-15230 This patch is disabled on Cloud -->
    <!-- Each tenant does lazy-creation of the SSD container, in the service when needed --> 
    <bean id="patch.syncSetDefinitionsContainer" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.syncSetDefinitionsContainer</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>5031</value></property>
        <property name="targetSchema"><value>5032</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- CLOUD-1912--> 
    <bean id="patch.show.audit" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.show.audit</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>6011</value></property>
        <property name="targetSchema"><value>6012</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- CLOUD-1912--> 
    <bean id="patch.updateMimetypesVISIO" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.updateMimetypesVISIO</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>6015</value></property>
        <property name="targetSchema"><value>6016</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- CLOUD-1970 This patch is disabled on Cloud as we are not exposing the Shared Files feature yet -->
    <bean id="patch.sharedFolder" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.sharedFolder</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>6023</value></property>
        <property name="targetSchema"><value>6024</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- CLOUD-1986 This patch is disabled on Cloud as site calendars are not enabled -->
    <bean id="patch.calendarAllDayEventDatesCorrectingPatch" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.calendarAllDayEventDatesCorrectingPatch</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>6026</value></property>
        <property name="targetSchema"><value>6027</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>

    <!-- SITE_ADMINISTRATORS GROUP is disabled in the CLOUD -->
    <bean id="patch.siteAdministrators" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.siteAdministrators</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>7002</value></property>
        <property name="targetSchema"><value>7003</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>

    <!-- ALFRESCO_SEARCH_ADMINISTRATORS GROUP is disabled in the CLOUD -->
    <bean id="patch.alfrescoSearchAdministrators" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch" >
        <property name="id"><value>patch.alfrescoSearchAdministrators</value></property>
        <property name="description"><value>patch.noOpPatch.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>7003</value></property>
        <property name="targetSchema"><value>7004</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    
    <!-- Ignore long running DB patch for now -->
    <bean id="patch.db-V4.1-createIdxAlfNodeTQN" class="org.alfresco.repo.admin.patch.impl.SchemaUpgradeScriptPatch" parent="basePatch">
        <property name="id"><value>patch.db-V4.1-createIdxAlfNodeTQN</value></property>
        <property name="description"><value>patch.schemaUpgradeScript.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>7000</value></property>
        <property name="targetSchema"><value>7001</value></property>
        <property name="scriptUrl">
            <value>classpath:alfresco/module/org_alfresco_module_cloud/dbscripts/upgrade/createIdxAlfNodeTQN.sql</value>
        </property>
    </bean>
 
    <!-- ACE-2151 - Disabled patch.renameSiteAuthorityDisplayName for release 37 -->
    <bean id="patch.renameSiteAuthorityDisplayName" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch">
        <property name="id"><value>patch.renameSiteAuthorityDisplayName</value></property>
        <property name="description"><value>patch.renameSiteAuthorityDisplayName.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>8000</value></property>
        <property name="targetSchema"><value>8001</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
 
    <!-- MNT-13180 - Disabled patch.fixWebscriptTemplate for Cloud 40, as it would have to update a sample file in every tenant -->
    <bean id="patch.fixWebscriptTemplate" class="org.alfresco.repo.admin.patch.impl.NoOpPatch" parent="basePatch">
        <property name="id"><value>patch.fixWebscriptTemplate</value></property>
        <property name="description"><value>patch.fixWebscriptTemplate.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>9000</value></property>
        <property name="targetSchema"><value>9001</value></property>
        <property name="applyToTenants"><value>false</value></property>
    </bean>
    <!--                   -->
    <!--  Active Patches   -->
    <!--                   -->

   <!-- CLOUD-45, CLOUD-46 and CLOUD-47: reminder-timers or auto-terminate-timers added -->
   <bean id="patch.redeployProcessesWithReminders2" class="org.alfresco.repo.admin.patch.impl.GenericWorkflowPatch" parent="basePatch" >
      <property name="id"><value>patch.redeployProcessesWithReminders2</value></property>
      <property name="description"><value>Redeploying signup, invite and password-reset flows with reminders and/or self-termination timers</value></property>
      <property name="fixesFromSchema"><value>0</value></property>
      <property name="fixesToSchema"><value>5034</value></property>
      <property name="targetSchema"><value>5035</value></property>
      <property name="applyToTenants" value="false" />
      <property name="workflowDefinitions">
         <list>
            <props>
                <prop key="engineId">activiti</prop>
                <prop key="location">alfresco/workflow/account-self-signup_processdefinition.bpmn20.xml</prop>
                <prop key="mimetype">text/xml</prop>
            </props>
            <props>
                <prop key="engineId">activiti</prop>
                <prop key="location">alfresco/workflow/cloud-site-invitation_processdefinition.bpmn20.xml</prop>
                <prop key="mimetype">text/xml</prop>
            </props>
            <props>
                <prop key="engineId">activiti</prop>
                <prop key="location">alfresco/workflow/reset-password_processdefinition.bpmn20.xml</prop>
                <prop key="mimetype">text/xml</prop>
            </props>
        </list>
     </property>
   </bean>

   <!-- Redeploy cloud workflow definitions for configurable remind times -->
   <bean id="patch.redeployProcessesWithReminders3" class="org.alfresco.repo.admin.patch.impl.GenericWorkflowPatch" parent="basePatch" >
      <property name="id"><value>patch.redeployProcessesWithReminders3</value></property>
      <property name="description"><value>Redeploying signup, invite and password-reset flows with configurable reminders and/or self-termination timers</value></property>
      <property name="fixesFromSchema"><value>0</value></property>
      <property name="fixesToSchema"><value>5035</value></property>
      <property name="targetSchema"><value>5036</value></property>
      <property name="applyToTenants" value="false" />
      <property name="workflowDefinitions">
         <list>
            <props>
                <prop key="engineId">activiti</prop>
                <prop key="location">alfresco/workflow/account-self-signup_processdefinition.bpmn20.xml</prop>
                <prop key="mimetype">text/xml</prop>
            </props>
            <props>
                <prop key="engineId">activiti</prop>
                <prop key="location">alfresco/workflow/cloud-site-invitation_processdefinition.bpmn20.xml</prop>
                <prop key="mimetype">text/xml</prop>
            </props>
            <props>
                <prop key="engineId">activiti</prop>
                <prop key="location">alfresco/workflow/reset-password_processdefinition.bpmn20.xml</prop>
                <prop key="mimetype">text/xml</prop>
            </props>
        </list>
     </property>
   </bean>

</beans>
