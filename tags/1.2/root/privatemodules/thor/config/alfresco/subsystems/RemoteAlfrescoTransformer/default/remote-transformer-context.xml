<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN 2.0//EN' 'http://www.springframework.org/dtd/spring-beans-2.0.dtd'>

<beans>
    <bean id="remoteTransformerHttpClientFactory" class="org.alfresco.httpclient.HttpClientFactory" init-method="init">
        <property name="secureCommsType" value="${remote.transformer.secureComms}"/>
        <property name="sSLEncryptionParameters" ref="sslEncryptionParameters"/>
        <property name="keyResourceLoader" ref="springKeyResourceLoader"/>
        <property name="keyStoreParameters" ref="keyStoreParameters"/>
        <property name="encryptionParameters" ref="md5EncryptionParameters"/>
        <property name="host" value="${remote.transformer.host}"/>
        <property name="port" value="${remote.transformer.port}"/>
        <property name="sslPort" value="${remote.transformer.port.ssl}"/>
        <property name="maxTotalConnections" value="${remote.transformer.max.total.connections}"/>
        <property name="maxHostConnections" value="${remote.transformer.max.host.connections}"/>
        <property name="connectionTimeout" value="${remote.transformer.connectionTimeout}"/>
    </bean>
    
   <!-- Cache factory for creating non-clustered/local caches for remote transformer subsystem. -->
   <bean id="rtCacheFactory" class="org.alfresco.repo.cache.DefaultCacheFactory">
      <property name="properties">
         <props>
            <prop key="cache.transformationCheckCache.maxItems">${cache.transformationCheckCache.maxItems}</prop>
            <prop key="cache.transformationCheckCache.timeToLiveSeconds">${cache.transformationCheckCache.timeToLiveSeconds}</prop>
            <prop key="cache.transformationCheckCache.maxIdleSeconds">${cache.transformationCheckCache.maxIdleSeconds}</prop>
         </props>
      </property>
   </bean>
   
   <!-- Remote transformation server transformation check cache -->
   <bean name="transformationCheckCache" factory-bean="rtCacheFactory" factory-method="createLocalCache">
      <constructor-arg value="cache.transformationCheckCache"/>      
   </bean>

	<bean id="transformer.worker.remote.alfresco"
		class="org.alfresco.module.org_alfresco_module_cloud.repo.content.transform.RemoteAlfrescoTransformerWorkerImpl">
		<property name="checkCache" ref="transformationCheckCache"/>
        <property name="enabled" value="${remote.alfresco.transformer.enabled}"/>
		<property name="mimetypeService">
			<ref bean="MimetypeService" />
		</property>
		<property name="httpClientFactory">
            <ref bean="remoteTransformerHttpClientFactory" />
        </property>
		<property name="username">
			<value>${remote.alfresco.transformer.username}</value>
		</property>
		<property name="password">
			<value>${remote.alfresco.transformer.password}</value>
		</property>
	</bean>
</beans>